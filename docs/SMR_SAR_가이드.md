# SMR SAR 문서 자동화 시스템 구축 가이드

## 최종 목표

**우리가 만들 것** = 설계 데이터를 입력하면 SAR 문서를 자동 생성/검토하는 시스템

---

## 핵심 개념: SAR 문서의 구성

```
SAR 문서 = 양식(20%) + 기술 콘텐츠(80%)
              ↑              ↑
         규정 문서에서      설계팀이 제공
         구조/형식 학습     (도면, 계산서, 분석 결과)
```

| 구분 | 내용 | 자동화 가능 여부 |
|------|------|:---------------:|
| **양식 (20%)** | 목차, 구조, 필수 항목, 작성 방법 | ✅ 학습 가능 |
| **기술 콘텐츠 (80%)** | 원자로 설계, 안전계통, 사고분석 등 | ❌ 엔지니어가 생성 |
| **문서화 작업** | 기술 데이터 → SAR 형식 변환 | ✅ **자동화 대상** |

---

## 자동화 시스템이 하는 일

| 자동화 대상 | 설명 | 예시 |
|------------|------|------|
| **문서 생성/조립** | 설계 데이터를 SAR 양식에 맞게 변환 | 설계 DB → SAR Chapter 형식 |
| **일관성 검증** | 문서 간 수치/용어 불일치 탐지 | "Chapter 4에선 150MW, Chapter 15에선 145MW" |
| **추적성 관리** | 요구사항 ↔ 설계 ↔ 검증 연결 | SRP 요구사항이 SAR 어디서 충족되는지 |
| **반복 작업** | 비슷한 구조의 섹션 대량 생성 | 밸브 100개 각각의 안전 분석 문서 |
| **규정 준수 체크** | SRP/DSRS 요구사항 충족 여부 확인 | "이 섹션에 필수 항목 빠졌음" |
| **근거 검색** | NRC 질의 대응 시 관련 문서 자동 검색 | "이 설계 결정의 근거는?" |

---

## 시스템 구축에 필요한 3가지 핵심 요소

### 1. 입력 데이터

| 데이터 | 설명 | 형태 |
|--------|------|------|
| **규정 문서** | RG 1.206, SRP, DSRS | PDF → 파싱/구조화 필요 |
| **합격 샘플** | NuScale DCA Rev 4.1 | 작성 패턴 학습용 |
| **설계 데이터** | 우리 SMR의 도면, 사양, 계산서 | 구조화된 DB 또는 파싱 가능한 형태 |

### 2. 매핑 체계 (핵심!)

| 매핑 | 왜 필요한가 |
|------|------------|
| **SRP 요구사항 ↔ SAR 섹션** | "이 요구사항은 SAR 어디에 써야 하나" |
| **설계 데이터 ↔ SAR 섹션** | "이 설계 정보는 SAR 어디에 들어가나" |
| **용어 표준화** | 같은 개념의 일관된 표현 |

### 3. 처리 엔진

| 엔진 | 역할 |
|------|------|
| **지식그래프** | 규정, 설계, 문서 간 관계 저장 |
| **GraphRAG** | 관련 정보 검색 및 문서 생성 |
| **검증 엔진** | 일관성/충족성 자동 체크 |

---

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        입력 데이터                               │
├──────────────────┬──────────────────┬──────────────────────────┤
│    규정 문서      │    합격 샘플      │      설계 데이터          │
│  (SRP, DSRS,     │  (NuScale DCA)   │   (도면, 사양, 계산서)     │
│   RG 1.206)      │                  │                          │
└────────┬─────────┴────────┬─────────┴─────────────┬────────────┘
         │                  │                       │
         ▼                  ▼                       ▼
┌─────────────────────────────────────────────────────────────────┐
│                      파싱 & 구조화 레이어                        │
│  - PDF → 텍스트/구조 추출                                        │
│  - 요구사항 ID 부여                                              │
│  - 설계 데이터 스키마 정규화                                      │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     지식그래프 (Neo4j)                           │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐                   │
│  │ 요구사항  │───▶│ SAR 섹션 │◀───│ 설계 데이터│                   │
│  │  노드    │    │   노드   │    │   노드    │                   │
│  └──────────┘    └──────────┘    └──────────┘                   │
│         │              │              │                         │
│         └──────────────┼──────────────┘                         │
│                        │                                        │
│              매핑 관계 (Relationships)                           │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      GraphRAG 엔진                               │
│  - 요구사항 기반 관련 정보 검색                                    │
│  - 설계 데이터 → SAR 섹션 초안 생성                                │
│  - NuScale 패턴 참조하여 문장 생성                                 │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      검증 & 출력                                 │
│  - 일관성 검증 (수치, 용어)                                       │
│  - 요구사항 충족 체크                                             │
│  - SAR 문서 생성                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 에이전트 툴 설계

### 왜 필요한가?

```
기존 생각:
    입력 → 파싱 → 지식그래프 → 출력  (파이프라인)

추가로 필요한 것:
    에이전트가 "어떤 도구를 호출"해서 작업하는가?  (툴 콜링)
```

에이전트는 **도구(Tool)를 호출**해서 작업함. 도구가 잘 설계되어야 에이전트가 제대로 동작함.

---

### 에이전트 동작 흐름

```
┌─────────────────────────────────────────────────────────────┐
│                    SAR 작성 에이전트                         │
│                                                             │
│   사용자: "Chapter 4 원자로 섹션 작성해줘"                   │
│                         │                                   │
│                         ▼                                   │
│   ┌─────────────────────────────────────────────────────┐   │
│   │              Tool Calling (도구 호출)                │   │
│   ├─────────────────────────────────────────────────────┤   │
│   │                                                     │   │
│   │  1. 요구사항_검색(chapter=4)                         │   │
│   │     → "Chapter 4에서 충족해야 할 SRP 요구사항 뭐야?"  │   │
│   │                                                     │   │
│   │  2. 패턴_검색(chapter=4, source="NuScale")          │   │
│   │     → "NuScale은 Chapter 4를 어떻게 썼어?"          │   │
│   │                                                     │   │
│   │  3. 설계데이터_조회(component="reactor")             │   │
│   │     → "우리 원자로 설계 데이터 뭐야?"                │   │
│   │                                                     │   │
│   │  4. 초안_생성(template, data)                       │   │
│   │     → "이 양식에 이 데이터 넣어서 초안 만들어"       │   │
│   │                                                     │   │
│   │  5. 일관성_검증(draft)                              │   │
│   │     → "다른 챕터랑 수치 충돌 없어?"                  │   │
│   │                                                     │   │
│   │  6. 요구사항_충족_체크(draft, requirements)         │   │
│   │     → "필수 항목 다 들어갔어?"                       │   │
│   │                                                     │   │
│   └─────────────────────────────────────────────────────┘   │
│                         │                                   │
│                         ▼                                   │
│                    SAR 초안 출력                            │
└─────────────────────────────────────────────────────────────┘
```

---

### 도구(Tool) 목록

#### 1. 검색 도구 (Search Tools)

| 도구명 | 설명 | 입력 | 출력 |
|--------|------|------|------|
| `search_requirements` | SRP/DSRS 요구사항 검색 | chapter, keyword | 요구사항 목록 |
| `search_pattern` | NuScale DCA 작성 패턴 검색 | chapter, section | 유사 문장/구조 |
| `search_regulation` | 규정 조항 검색 (10 CFR, GDC) | keyword | 관련 규정 텍스트 |
| `search_definition` | 용어 정의 검색 | term | 정의, 출처 |

#### 2. 조회 도구 (Query Tools)

| 도구명 | 설명 | 입력 | 출력 |
|--------|------|------|------|
| `get_design_data` | 설계 데이터 조회 | component, parameter | 설계값, 단위, 출처 |
| `get_section_structure` | SAR 섹션 구조 조회 | chapter, section | 필수 항목, 순서 |
| `get_related_sections` | 관련 섹션 조회 | section_id | 연결된 섹션 목록 |
| `get_traceability` | 추적성 조회 | requirement_id | 관련 설계/문서 링크 |

#### 3. 생성 도구 (Generation Tools)

| 도구명 | 설명 | 입력 | 출력 |
|--------|------|------|------|
| `generate_draft` | 섹션 초안 생성 | template, data, pattern | 초안 텍스트 |
| `generate_table` | 표 자동 생성 | schema, data | 마크다운/HTML 표 |
| `generate_reference` | 참조 문장 생성 | source_docs | 인용 문장 |

#### 4. 검증 도구 (Validation Tools)

| 도구명 | 설명 | 입력 | 출력 |
|--------|------|------|------|
| `validate_consistency` | 일관성 검증 | draft, existing_docs | 불일치 목록 |
| `validate_completeness` | 완전성 검증 | draft, requirements | 누락 항목 목록 |
| `validate_terminology` | 용어 일관성 검증 | draft | 비표준 용어 목록 |
| `validate_numbers` | 수치 일관성 검증 | draft | 수치 불일치 목록 |

#### 5. 추적 도구 (Traceability Tools)

| 도구명 | 설명 | 입력 | 출력 |
|--------|------|------|------|
| `trace_requirement` | 요구사항 → 문서 추적 | req_id | SAR 위치 목록 |
| `trace_design` | 설계 → 문서 추적 | design_id | SAR 위치 목록 |
| `find_justification` | 근거 문서 찾기 | decision | 관련 문서/계산서 |

---

### 수정된 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                       지식그래프 (Neo4j)                     │
│                                                             │
│   [요구사항] ←→ [SAR섹션] ←→ [설계데이터] ←→ [NuScale패턴]  │
│       │            │            │              │            │
│       └────────────┴────────────┴──────────────┘            │
│                         │                                   │
│                    매핑 관계 저장                            │
└───────────────────────────┬─────────────────────────────────┘
                            │
                   GraphRAG (검색/생성)
                            │
┌───────────────────────────┴─────────────────────────────────┐
│                        Tool Layer                           │
├──────────┬──────────┬──────────┬──────────┬─────────────────┤
│  검색    │  조회    │  생성    │  검증    │  추적           │
│ search_* │ get_*    │generate_*│validate_*│ trace_*         │
└──────────┴──────────┴──────────┴──────────┴─────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    SAR 작성 에이전트                         │
│              (LLM + Tool Calling + 워크플로우)               │
│                                                             │
│   - 사용자 요청 이해                                         │
│   - 적절한 도구 선택 & 호출                                  │
│   - 결과 조합하여 SAR 초안 생성                              │
│   - 검증 도구로 품질 확인                                    │
└─────────────────────────────────────────────────────────────┘
```

---

### 에이전트 워크플로우 예시

#### 예시: "Chapter 4.2 원자로 냉각재 계통 섹션 작성"

```
Step 1: 요구사항 파악
        └→ search_requirements(chapter="4.2")
        └→ 결과: "SRP 4.2.1 요구사항 목록"

Step 2: 작성 패턴 확인
        └→ search_pattern(chapter="4.2", source="NuScale")
        └→ 결과: "NuScale DCA Chapter 4.2 구조 및 문장 패턴"

Step 3: 설계 데이터 수집
        └→ get_design_data(component="RCS")
        └→ 결과: "압력, 온도, 유량 등 설계값"

Step 4: 섹션 구조 확인
        └→ get_section_structure(chapter="4.2")
        └→ 결과: "필수 포함 항목: 설계기준, 시스템설명, 안전기능..."

Step 5: 초안 생성
        └→ generate_draft(template, data, pattern)
        └→ 결과: "Chapter 4.2 초안"

Step 6: 검증
        └→ validate_consistency(draft)
        └→ validate_completeness(draft, requirements)
        └→ 결과: "불일치 0건, 누락 0건" 또는 수정 필요 사항

Step 7: 출력
        └→ SAR Chapter 4.2 초안 완성
```

---

## 구축 우선순위

### Phase 1: 데이터 준비 (기반)

| 순서 | 작업 | 산출물 |
|:---:|------|--------|
| 1 | SRP/DSRS 요구사항 파싱 & 구조화 | 요구사항 목록 (ID, 내용, 대상 섹션) |
| 2 | NuScale DCA 섹션별 분석 | 섹션별 작성 패턴, 템플릿 |
| 3 | 설계 데이터 스키마 정의 | 입력 데이터 형식 명세 |
| 4 | 요구사항 ↔ 설계 ↔ 문서 매핑 테이블 | **핵심 매핑 관계** |

### Phase 2: 지식그래프 구축

| 순서 | 작업 | 산출물 |
|:---:|------|--------|
| 1 | DIAMOND 온톨로지 분석 | 원자력 도메인 스키마 |
| 2 | Neo4j 그래프 설계 | 노드/엣지 정의 |
| 3 | 데이터 적재 파이프라인 | ETL 시스템 |
| 4 | 매핑 관계 그래프화 | 연결된 지식그래프 |

### Phase 3: 자동화 엔진 개발

| 순서 | 작업 | 산출물 |
|:---:|------|--------|
| 1 | GraphRAG 파이프라인 구성 | 검색/생성 엔진 |
| 2 | SAR 섹션 생성 시스템 | 초안 자동 생성 |
| 3 | 검증 워크플로우 | 일관성/충족성 체크 |
| 4 | 리뷰/수정 인터페이스 | 사용자 검토 도구 |

---

## 필수 문서 및 리소스

### 규정 문서 (파싱 대상)

| 문서 | 용도 | 링크 |
|------|------|------|
| **SRP (NUREG-0800)** | 평가 기준 → 요구사항 추출 | [NRC SRP](https://www.nrc.gov/reading-rm/doc-collections/nuregs/staff/sr0800/index) |
| **DSRS** | SMR 특화 기준 | [NRC DSRS](https://www.nrc.gov/docs/ML1535/ML15355A295.html) |
| **RG 1.206** | SAR 작성 방법론 | [PDF](https://www.nrc.gov/docs/ML1813/ML18131A181.pdf) |

### 참고 샘플 (패턴 학습용)

| 자료 | 용도 | 링크 |
|------|------|------|
| **NuScale DCA Rev 4.1** | 합격 SAR 샘플 | [NRC](https://www.nrc.gov/docs/ML2020/ML20205L562.html) |

### 기술 스택

| 도구 | 용도 | 링크 |
|------|------|------|
| **Neo4j** | 지식그래프 DB | - |
| **neo4j-graphrag-python** | GraphRAG 구현 | [GitHub](https://github.com/neo4j/neo4j-graphrag-python) |
| **DIAMOND 온톨로지** | 원자력 도메인 스키마 | [GitHub](https://github.com/idaholab/DIAMOND) |
| **DIAMOND 문서** | 온톨로지 상세 설명 | [PDF](https://inldigitallibrary.inl.gov/sites/sti/sti/Sort_19876.pdf) |

### 국내 참고 자료

| 자료 | 설명 | 링크 |
|------|------|------|
| **비즈(주) DSRS 보고서 1** | 국내 DSRS 조사 | [링크](https://www.rmas.or.kr/bsr/board.php?bo_table=smr&wr_id=65&page=1) |
| **비즈(주) DSRS 보고서 2** | 국내 DSRS 조사 | [링크](https://www.rmas.or.kr/bsr/board.php?bo_table=smr&wr_id=64&page=1) |

---

## 용어 정리

| 약어 | 전체 명칭 | 설명 |
|------|-----------|------|
| SMR | Small Modular Reactor | 소형모듈원자로 |
| SAR | Safety Analysis Report | 안전성분석보고서 |
| SRP | Standard Review Plan | 표준심사계획서 (NUREG-0800) |
| DSRS | Design Specific Review Standard | 설계별 심사기준 |
| LWR | Light Water Reactor | 경수로 |
| NRC | Nuclear Regulatory Commission | 미국 원자력규제위원회 |
| DCA | Design Certification Application | 설계인증신청서 |
| NPP | Nuclear Power Plant | 원자력발전소 |
| GraphRAG | Graph Retrieval-Augmented Generation | 그래프 기반 검색증강생성 |

---

## 첫 번째 할 일

| 우선순위 | 작업 | 이유 |
|:-------:|------|------|
| **1** | SRP 문서 파싱 & 요구사항 목록화 | 자동화의 시작점 - "뭘 써야 하는지" 목록 |
| **2** | NuScale DCA 섹션 구조 분석 | "어떻게 썼는지" 패턴 추출 |
| **3** | 요구사항 ↔ SAR 섹션 매핑 테이블 작성 | **핵심 매핑** - 이게 있어야 자동화 가능 |
| **4** | 설계 데이터 입력 스키마 정의 | 어떤 형태로 데이터 받을지 결정 |

---

## 한 줄 요약

> **SRP 요구사항 + NuScale 작성 패턴 + 설계 데이터 스키마**의 **매핑 관계**가 시스템의 핵심.
> 이 매핑이 구축되면 문서 생성/검토/검색이 자동화된다.
