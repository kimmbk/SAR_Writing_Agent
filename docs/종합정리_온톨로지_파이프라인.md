# SAR 자동화 시스템 종합 정리 + 온톨로지 파이프라인 심화

**작성일**: 2026.02.09
**목적**: 여태까지 공부한 모든 내용 종합 + 온톨로지 파이프라인 구축 심화 정리

---

## Part 1: 여태까지 공부한 것 총정리

---

### 1. NRC 규제체계 (기초)

```
미국에서 원전 짓고 싶으면?

┌──────────────────────────────────────────────────────────┐
│                         10 CFR                            │
│                  (미국 원자력 규제 법률집)                  │
│                                                           │
│   Part 50 (옛날 방식)          Part 52 (요즘 방식)         │
│   건설허가 → 운영허가           통합인허가 (한방에)          │
│                                                           │
│   GDC (일반설계기준) = Part 50 Appendix A                  │
│   → Part 52도 이거 따름                                    │
└──────────────────────────────────────────────────────────┘
```

**핵심 문서 관계**:

| 문서 | 누가 보나 | 역할 |
|------|----------|------|
| **10 CFR** | 모두 | 법률 (지켜야 함) |
| **RG 1.206** | 신청자 | "SAR 이렇게 써라" (Part 52용 가이드) |
| **SRP (NUREG-0800)** | NRC 직원 | "이렇게 검토해라" (대형원전용) |
| **DSRS** | NRC 직원 | "이렇게 검토해라" (SMR용) |
| **NuScale DCA** | 우리(참고) | 실제 승인된 SAR 샘플 |

---

### 2. SAR 문서 구조 (19개 챕터)

```
SAR 문서 = 양식(20%) + 기술 콘텐츠(80%)
              ↑              ↑
         규정에서 학습      설계팀이 제공
         (자동화 가능)      (엔지니어 영역)
```

| Ch | 제목 | 성격 | 우선순위 |
|:--:|------|------|:-------:|
| 1 | Introduction | 소개 | |
| 2 | Site Characteristics | 부지 | |
| 3 | Design of Structures... | 설계 | |
| **4** | **Reactor** | **핵심** | **⭐ 파일럿 대상** |
| 5 | Reactor Coolant System | 설계 | |
| **6** | **Engineered Safety Features** | **핵심** | **⭐** |
| 7 | Instrumentation and Controls | 계측 | |
| 8 | Electric Power | 전력 | |
| 9 | Auxiliary Systems | 보조 | |
| 10 | Steam and Power Conversion | 증기 | |
| 11 | Radioactive Waste Management | 운영 | |
| 12 | Radiation Protection | 안전 | |
| 13 | Conduct of Operations | 운영 | |
| 14 | Initial Test Programs / ITAAC | 시험 | |
| **15** | **Transient and Accident Analysis** | **핵심** | **⭐** |
| 16 | Technical Specifications | 규제 | |
| 17 | Quality Assurance | 관리 | |
| 18 | Human Factors Engineering | 인간공학 | |
| 19 | Probabilistic Risk Assessment | 위험 | |

---

### 3. 시스템 아키텍처 설계

우리가 만들 것 = **설계 데이터를 입력하면 SAR 문서를 자동 생성/검토하는 시스템**

```
┌─────────────────────────────────────────────────────────────┐
│                    사용자 인터페이스                           │
│         (Web UI, Chat Interface, API Gateway)                │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                 SAR 작성 에이전트 (LLM 기반)                  │
│          사용자 의도 파악 → 도구 선택/호출 → 결과 조합         │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                      Tool Layer (5종)                        │
│  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐          │
│  │검색  │  │조회  │  │생성  │  │검증  │  │추적  │          │
│  │Tools │  │Tools │  │Tools │  │Tools │  │Tools │          │
│  └──────┘  └──────┘  └──────┘  └──────┘  └──────┘          │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                      Data Layer                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │  Neo4j      │  │  VectorDB   │  │  DocumentDB │          │
│  │ (지식그래프) │  │ (임베딩검색) │  │  (원문저장)  │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

#### 5가지 Tool 카테고리

| 카테고리 | 도구 | 하는 일 |
|---------|------|--------|
| **검색** | `search_requirements`, `search_pattern`, `search_regulation`, `search_definition` | SRP 요구사항, NuScale 패턴, 규정 조항 검색 |
| **조회** | `get_design_data`, `get_section_structure`, `get_related_sections`, `get_traceability` | 설계 데이터, 섹션 구조, 추적성 조회 |
| **생성** | `generate_draft`, `generate_table`, `generate_reference` | SAR 초안, 표, 참조문 생성 |
| **검증** | `validate_consistency`, `validate_completeness`, `validate_terminology`, `validate_numbers` | 일관성, 완전성, 용어, 수치 검증 |
| **추적** | `trace_requirement`, `trace_design`, `find_justification` | 요구사항→문서 추적, 근거 검색 |

---

### 4. 아키텍처 의사결정 사항

#### 정적 vs 동적 데이터 구분

```
┌───────────────────────────────┬───────────────────────────┐
│  정적 데이터 (1회 적재)        │  동적 데이터 (실시간 연동)  │
├───────────────────────────────┼───────────────────────────┤
│  SRP (NUREG-0800)             │  SMART 설계 데이터         │
│  DSRS                         │  작성 중인 SAR             │
│  RG 1.206                     │  변경 이력                 │
│  NuScale DCA                  │                           │
│  10 CFR                       │                           │
├───────────────────────────────┼───────────────────────────┤
│  거의 안 바뀜 → VectorDB 사전적재│  계속 바뀜 → 실시간 연동    │
└───────────────────────────────┴───────────────────────────┘
```

#### VectorDB만? vs VectorDB + 지식그래프?

**결론: 둘 다 필요 (Option B)**

| 역할 | VectorDB | 지식그래프 (Neo4j) |
|------|----------|-------------------|
| 검색 방식 | 의미 기반 (유사 문장 찾기) | 관계 기반 (요구사항→SAR 추적) |
| 강점 | "비슷한 내용" 검색 | "연결된 것" 추적 |
| 용도 | RAG, 패턴 매칭 | 추적성, 영향분석, 일관성 검증 |
| 필수 이유 | 자연어 검색 | **요구사항↔SAR↔설계 매핑이 프로젝트 핵심** |

---

### 5. PDF 파싱 테스트 결과

#### MinerU 파이프라인

```
PDF → 페이지 이미지 → Layout Detection (DocLayout-YOLO)
    → Formula Detection → Table Processing → OCR (PaddleOCR)
    → model.json → middle.json → content_list.json → Markdown
```

| 파일 | 역할 | 용도 |
|------|------|------|
| `model.json` | 딥러닝 모델 원시 출력 (블록+스팬) | 디버깅 |
| `middle.json` | 후처리 (블록에 스팬 매칭, 정렬) | 중간 결과 |
| `content_list.json` | RAG-ready 플랫 리스트 | **VectorDB 적재용** |
| `.md` | 사람이 읽을 수 있는 Markdown | 확인용 |

#### RG 1.206 파싱 결과

| 항목 | 결과 |
|------|------|
| 섹션 구조 | ✅ 정상 (312개 `#` 마커) |
| CFR 참조 | ✅ 정상 |
| § 기호 | ❌ 깨짐 (`§52.17` → `$\ S 5 2 . 1 7$`) |
| 표 구조 | ⚠️ HTML (Markdown 아님) |
| 전체 점수 | ~85% (후처리 필요) |

#### 도구 비교

| 도구 | 장점 | 단점 |
|------|------|------|
| **MinerU** | 정밀, 구조 보존 | § 깨짐, 설치 복잡 |
| **pdfplumber** | 테이블 특화, 빠름 | 레이아웃 이해 약함 |
| Docling | 빠름, 단순 | 멀티모달 아님 |
| PyMuPDF | 매우 빠름 | 구조 보존 약함 |

---

### 6. 현재 진행 상태

| 항목 | 상태 |
|------|:----:|
| NRC 규제체계 이해 | ✅ |
| 시스템 아키텍처 설계 | ✅ |
| RFP 작성 | ✅ |
| PDF 파싱 테스트 (MinerU, pdfplumber) | ✅ |
| RG 1.206 파싱 완료 | ✅ |
| Tool 설계 (5개 카테고리) | ✅ |
| 개발자 질문지 정리 | ✅ |
| VectorDB 구현 | ⬜ |
| 지식그래프 스키마 구현 | ⬜ |
| 온톨로지 설계 (DIAMOND 기반) | ⬜ ← **다음 단계** |
| 에이전트 개발 | ⬜ |

---

---

## Part 2: 온톨로지 파이프라인 심화

---

### 7. 온톨로지란 무엇인가

```
온톨로지 = "도메인의 개념과 관계를 형식적으로 정의한 것"

쉽게 말하면:
┌─────────────────────────────────────────────────────────┐
│  "이 세계에 어떤 것들이 있고, 그것들이 어떻게 연결되는가" │
│   를 컴퓨터가 이해할 수 있게 정의한 것                    │
└─────────────────────────────────────────────────────────┘

예시:
  "요구사항"은 "SAR 섹션"에 의해 "충족된다" (FULFILLS)
  "설계 데이터"는 "SAR 섹션"에 의해 "사용된다" (USES)
  "설계 변경"은 "SAR 섹션"에 "영향을 준다" (IMPACTS)
```

#### 왜 필요한가?

| 온톨로지 없이 | 온톨로지 있으면 |
|-------------|---------------|
| LLM이 문맥 파악 못함 | 정확한 관계 추적 가능 |
| "열출력" 검색하면 관련 없는 것도 나옴 | "열출력 변경 → 영향받는 SAR 섹션" 자동 추적 |
| 요구사항 충족 여부 수동 확인 | 그래프 쿼리로 자동 확인 |
| 데이터가 구조 없이 뒤섞임 | 개념 간 관계가 명확히 정의됨 |

---

### 8. DIAMOND 온톨로지

#### 8.1 DIAMOND이란?

```
DIAMOND = Domain Integrated Assessment and Management Of Nuclear Design

┌─────────────────────────────────────────────────────────┐
│  Idaho National Lab (INL)에서 개발한                      │
│  원자력 도메인 전용 온톨로지                               │
│                                                          │
│  목적: 원자력 설계/인허가 지식의 형식적 표현                │
│  GitHub: https://github.com/idaholab/DIAMOND             │
│  논문: INL/EXT-19-56176                                   │
└─────────────────────────────────────────────────────────┘
```

#### 8.2 DIAMOND 핵심 개념

DIAMOND은 원자력 도메인의 개념들을 **클래스(Class)**로 정의하고, 클래스 간 **관계(Property)**를 정의함:

```
DIAMOND 핵심 클래스:
├── System (계통)
│   ├── hasComponent → Component
│   ├── performsFunction → Function
│   └── hasProperty → Parameter
│
├── Component (기기)
│   ├── partOf → System
│   ├── hasFailureMode → FailureMode
│   └── hasSpecification → Specification
│
├── Function (기능)
│   ├── performedBy → System/Component
│   └── satisfiesRequirement → Requirement
│
├── Requirement (요구사항)
│   ├── derivedFrom → Regulation
│   ├── satisfiedBy → Function
│   └── documentedIn → Document
│
├── Regulation (규제)
│   ├── contains → Requirement
│   └── appliesTo → System/Component
│
└── Document (문서)
    ├── hasSection → Section
    ├── referencesDocument → Document
    └── documentsRequirement → Requirement
```

#### 8.3 우리가 DIAMOND을 어떻게 쓸 것인가

DIAMOND을 **그대로 쓰는 게 아니라 SAR 자동화에 맞게 확장**:

```
DIAMOND 원본                    우리의 확장
─────────────────               ─────────────────────────
System                    →     그대로 사용
Component                 →     그대로 사용
Function                  →     그대로 사용
Requirement               →     SRP/DSRS 요구사항으로 구체화
Document                  →     SAR 챕터/섹션으로 구체화
                                + Pattern (NuScale 작성 패턴) 추가
                                + DesignData (SMART 설계값) 추가
                                + ValidationRule (검증 규칙) 추가
```

---

### 9. SAR 온톨로지 스키마 설계

#### 9.1 노드 타입 정의

```
┌─────────────────────────────────────────────────────────────┐
│                    SAR 온톨로지 노드 타입                     │
└─────────────────────────────────────────────────────────────┘

1. Requirement (요구사항)
   ├── id: "SRP-4.2.1-001"
   ├── text: "Fuel system shall be designed to..."
   ├── source: "SRP 4.2.1" | "DSRS 4.2.1"
   ├── category: "DesignBasis" | "SafetyFeature" | "Analysis"
   ├── chapter: 4
   ├── acceptance_criteria: "구체적 판단 기준"
   └── gdc_reference: ["GDC-10", "GDC-27"]

2. SARSection (SAR 섹션)
   ├── id: "SAR-4.2.1"
   ├── title: "Fuel System Design"
   ├── chapter: 4
   ├── level: 3 (섹션 깊이)
   ├── template: "RG 1.206 기반 양식"
   ├── mandatory_items: ["설계기준", "시스템설명", "안전기능"]
   └── status: "draft" | "review" | "approved"

3. DesignData (설계 데이터)
   ├── id: "SMART-RCS-001"
   ├── parameter: "Thermal Power"
   ├── value: 330
   ├── unit: "MWth"
   ├── tolerance: "±5%"
   ├── source: "설계사양서 Rev 2.1"
   ├── system: "RCS" (연결된 계통)
   └── version: "Rev 2.1"

4. Pattern (작성 패턴)
   ├── id: "PAT-4.2.1-001"
   ├── source: "NuScale DCA Chapter 4.2"
   ├── template: "The [system] is designed to [function]..."
   ├── section_structure: [서브섹션 목록]
   └── example_sentences: ["참고 문장들"]

5. Regulation (규제 조항)
   ├── id: "10CFR50-GDC10"
   ├── title: "Reactor Design"
   ├── text: "조항 전문"
   ├── part: 50 | 52
   └── applicability: "LWR" | "SMR" | "All"

6. System (계통) — DIAMOND 확장
   ├── id: "SYS-RCS"
   ├── name: "Reactor Coolant System"
   ├── abbreviation: "RCS"
   ├── safety_class: "Safety-Related"
   └── description: "계통 설명"

7. Component (기기) — DIAMOND 확장
   ├── id: "COMP-RCP-001"
   ├── name: "Reactor Coolant Pump"
   ├── system: "RCS"
   ├── safety_class: "Safety-Related"
   └── specifications: {압력, 온도, 유량...}
```

#### 9.2 관계(Relationship) 타입 정의

```
┌─────────────────────────────────────────────────────────────┐
│                    관계 타입 정의                              │
└─────────────────────────────────────────────────────────────┘

핵심 관계 (SAR 자동화의 뼈대):
─────────────────────────────
FULFILLS     : SARSection → Requirement
               "이 SAR 섹션이 이 요구사항을 충족한다"
               예: SAR-4.2.1 —FULFILLS→ SRP-4.2.1-001

USES         : SARSection → DesignData
               "이 SAR 섹션이 이 설계 데이터를 사용한다"
               예: SAR-4.2.1 —USES→ SMART-RCS-001

REFERENCES   : SARSection → SARSection
               "이 섹션이 다른 섹션을 참조한다"
               예: SAR-4.2 —REFERENCES→ SAR-15.2

FOLLOWS      : SARSection → Pattern
               "이 섹션이 이 작성 패턴을 따른다"
               예: SAR-4.2 —FOLLOWS→ PAT-4.2.1-001

IMPACTS      : DesignData → SARSection
               "이 설계 데이터 변경이 이 섹션에 영향을 준다"
               예: SMART-RCS-001 —IMPACTS→ [SAR-4.2, SAR-5.2, SAR-15.2]

DERIVED_FROM : Requirement → Regulation
               "이 요구사항이 이 규제 조항에서 나온다"
               예: SRP-4.2.1-001 —DERIVED_FROM→ 10CFR50-GDC10

DIAMOND 확장 관계:
─────────────────
BELONGS_TO   : Component → System
               "이 기기가 이 계통에 속한다"

HAS_FUNCTION : System → Function
               "이 계통이 이 기능을 수행한다"

SATISFIES    : Function → Requirement
               "이 기능이 이 요구사항을 만족한다"
```

#### 9.3 관계 다이어그램

```
                    DERIVED_FROM
    [Regulation] ◄──────────────── [Requirement]
    (10 CFR,GDC)                       │
                                       │ FULFILLS
                                       ▼
    [Pattern]  ──FOLLOWS──►  [SARSection]  ◄──IMPACTS── [DesignData]
    (NuScale)                     │    │                    │
                                  │    │ USES               │
                                  │    └────────────────────┘
                                  │
                                  │ REFERENCES
                                  ▼
                            [SARSection]
                            (다른 챕터)

    DIAMOND 확장:
    [System] ──HAS_FUNCTION──► [Function] ──SATISFIES──► [Requirement]
       │
       │ BELONGS_TO
       ▼
    [Component] ──HAS_SPEC──► [DesignData]
```

---

### 10. 온톨로지 파이프라인 구축

#### 10.1 파이프라인 전체 흐름

```
┌─────────────────────────────────────────────────────────────┐
│              온톨로지 파이프라인 (전체 흐름)                   │
└─────────────────────────────────────────────────────────────┘

Step 1: 문서 수집 & 파싱
────────────────────────
    PDF 문서들 (SRP, DSRS, RG 1.206, NuScale DCA)
         │
         ▼
    MinerU / pdfplumber 파싱
         │
         ▼
    구조화된 텍스트 (content_list.json / Markdown)


Step 2: 엔티티 추출 (Entity Extraction)
───────────────────────────────────────
    구조화된 텍스트
         │
         ▼
    ┌─────────────────────────────────────────────┐
    │  LLM + Rule 기반 엔티티 추출                  │
    │                                              │
    │  입력: "SRP 4.2.1: The fuel system design    │
    │         shall ensure that fuel damage is     │
    │         not expected during normal operation  │
    │         (GDC-10)"                            │
    │                                              │
    │  출력:                                        │
    │  - Requirement: {                            │
    │      id: "SRP-4.2.1-001",                    │
    │      text: "fuel system design shall...",     │
    │      gdc_ref: "GDC-10",                      │
    │      category: "DesignBasis"                 │
    │    }                                         │
    └─────────────────────────────────────────────┘


Step 3: 관계 추출 (Relation Extraction)
───────────────────────────────────────
    추출된 엔티티들
         │
         ▼
    ┌─────────────────────────────────────────────┐
    │  관계 매핑 (자동 + 수동)                      │
    │                                              │
    │  자동: 섹션번호 매칭                           │
    │    SRP 4.2.1 요구사항 → SAR 4.2.1 섹션        │
    │                                              │
    │  자동: GDC 참조 추출                           │
    │    "(GDC-10)" → DERIVED_FROM 관계             │
    │                                              │
    │  자동: 교차참조 추출                           │
    │    "See Section 5.2" → REFERENCES 관계        │
    │                                              │
    │  반자동: 설계데이터-섹션 매핑                   │
    │    엔지니어 검증 필요                          │
    └─────────────────────────────────────────────┘


Step 4: 지식그래프 적재 (Graph Loading)
───────────────────────────────────────
    엔티티 + 관계
         │
         ▼
    ┌─────────────────────────────────────────────┐
    │  Neo4j에 노드/엣지 생성                      │
    │                                              │
    │  CREATE (r:Requirement {                     │
    │    id: "SRP-4.2.1-001",                      │
    │    text: "...",                               │
    │    source: "SRP 4.2.1"                       │
    │  })                                          │
    │                                              │
    │  CREATE (s:SARSection {                      │
    │    id: "SAR-4.2.1",                          │
    │    title: "Fuel System Design"               │
    │  })                                          │
    │                                              │
    │  CREATE (s)-[:FULFILLS]->(r)                 │
    └─────────────────────────────────────────────┘


Step 5: 벡터 인덱싱 (Vector Indexing)
────────────────────────────────────
    동시에 같은 텍스트를
         │
         ▼
    ┌─────────────────────────────────────────────┐
    │  VectorDB에 임베딩 저장                       │
    │                                              │
    │  텍스트 청킹 → 임베딩 생성 → VectorDB 적재    │
    │                                              │
    │  청킹 전략: 섹션 단위 (섹션번호 메타데이터 유지)│
    │  임베딩 모델: text-embedding-3-small 등       │
    └─────────────────────────────────────────────┘


Step 6: 하이브리드 검색 (GraphRAG)
──────────────────────────────────
    사용자 쿼리
         │
         ├─→ VectorDB (의미 검색): "비슷한 내용 찾기"
         │
         └─→ Neo4j (관계 검색): "연결된 것 찾기"
                   │
                   ▼
              결과 통합 → LLM → 응답 생성
```

#### 10.2 각 Step 상세

##### Step 1: 문서 파싱 전략

```
┌──────────────────────────────────────────────────────────┐
│  문서별 파싱 전략                                          │
├──────────────┬──────────────┬────────────────────────────┤
│  문서         │  도구         │  후처리                    │
├──────────────┼──────────────┼────────────────────────────┤
│  RG 1.206    │  MinerU      │  § 기호 복원, 표 정리       │
│  SRP         │  MinerU      │  섹션번호 정규화             │
│  DSRS        │  MinerU      │  섹션번호 정규화             │
│  NuScale DCA │  MinerU      │  패턴 추출용 구조화          │
│  10 CFR      │  웹 크롤링    │  조항 단위 구조화            │
└──────────────┴──────────────┴────────────────────────────┘

후처리 공통:
- § 기호 복원: $\ S 5 2 . 1 7$ → §52.17 (정규식)
- 표 HTML→Markdown 변환
- 섹션 번호 정규화: "4.2.1" 형식 통일
- 메타데이터 부여: {chapter, section, page, source}
```

##### Step 2: 엔티티 추출 전략

```
방법 1: 규칙 기반 (Rule-based) — 정확도 높음
──────────────────────────────────────────────
  - 섹션 번호 패턴: /\d+\.\d+(\.\d+)?/
  - GDC 참조 패턴: /GDC-\d+/
  - CFR 참조 패턴: /10\s*CFR\s*(Part\s*)?\d+(\.\d+)?/
  - 요구사항 키워드: "shall", "must", "required"

방법 2: LLM 기반 — 의미 파악 가능
──────────────────────────────────
  프롬프트:
  "다음 텍스트에서 엔티티를 추출하세요:
   - Requirement: 의무적 요구사항 (shall/must 포함)
   - DesignCriteria: 설계 기준 (수치, 조건)
   - Reference: 다른 문서/섹션 참조
   - SystemComponent: 계통/기기 이름"

방법 3: 하이브리드 (추천)
────────────────────────
  1. 규칙으로 1차 추출 (높은 재현율)
  2. LLM으로 검증 + 보완 (높은 정밀도)
  3. 사람이 최종 검수 (품질 보증)
```

##### Step 3: 관계 추출 전략

```
자동 매핑 가능한 관계:
─────────────────────
1. FULFILLS (요구사항 ↔ SAR 섹션)
   - SRP 섹션번호 = SAR 섹션번호 (1:1 매핑)
   - SRP 4.2.1 요구사항 → SAR 4.2.1에서 다뤄야 함
   - 자동화율: ~80%

2. DERIVED_FROM (요구사항 ↔ 규제조항)
   - 텍스트에서 "(GDC-10)", "10 CFR 50.46" 참조 추출
   - 정규식으로 자동 추출 가능
   - 자동화율: ~90%

3. REFERENCES (SAR 섹션 ↔ SAR 섹션)
   - "See Section 5.2", "as described in Chapter 15" 추출
   - 정규식 + LLM 보완
   - 자동화율: ~85%

반자동 매핑 필요한 관계:
───────────────────────
4. USES (SAR 섹션 ↔ 설계 데이터)
   - "The thermal power is 330 MWth" → 설계 데이터 연결
   - LLM으로 추출 + 엔지니어 검증
   - 자동화율: ~60% (검증 필요)

5. IMPACTS (설계 데이터 → SAR 섹션)
   - 설계 변경 시 영향 범위 분석
   - USES 관계의 역방향 + 전파 분석
   - 그래프 탐색으로 자동 계산
```

##### Step 4: Neo4j 그래프 설계

```cypher
// 노드 생성 예시

// 요구사항
CREATE (r:Requirement {
    id: "SRP-4.2.1-001",
    text: "The fuel system shall be designed to ensure...",
    source: "SRP",
    section: "4.2.1",
    chapter: 4,
    category: "DesignBasis",
    gdc_refs: ["GDC-10", "GDC-27"]
})

// SAR 섹션
CREATE (s:SARSection {
    id: "SAR-4.2.1",
    title: "Fuel System Design",
    chapter: 4,
    level: 3,
    mandatory_items: ["설계기준", "시스템설명", "안전기능", "설계평가"],
    status: "draft"
})

// 설계 데이터
CREATE (d:DesignData {
    id: "SMART-FUEL-001",
    parameter: "Fuel Assembly Length",
    value: 2.0,
    unit: "m",
    system: "Reactor Core",
    source: "SMART Design Spec Rev 2.1"
})

// 패턴
CREATE (p:Pattern {
    id: "PAT-4.2.1-001",
    source: "NuScale DCA 4.2.1",
    template: "The fuel system is designed to [criteria]. The design bases are...",
    structure: ["Design Bases", "Description", "Design Evaluation", "Testing"]
})

// 관계 생성
CREATE (s)-[:FULFILLS {confidence: 0.95}]->(r)
CREATE (s)-[:USES {data_type: "specification"}]->(d)
CREATE (s)-[:FOLLOWS]->(p)
CREATE (r)-[:DERIVED_FROM]->(reg:Regulation {id: "GDC-10"})
```

##### Step 5: 벡터 인덱싱 전략

```
청킹 전략 (규정문서 특화):
─────────────────────────
1. 섹션 단위 청킹 (1차)
   - 각 섹션(4.2.1 등)을 하나의 청크로
   - 메타데이터: {chapter, section, source, page}
   - 장점: 섹션번호 유지, 맥락 보존

2. 문단 단위 분할 (2차)
   - 섹션이 너무 길면 문단 단위로 추가 분할
   - 부모 섹션번호를 메타데이터로 유지
   - 오버랩: 50자

3. 요구사항 단위 청킹 (특수)
   - "shall" 문장 각각을 개별 청크로
   - 요구사항 ID 메타데이터 부여
   - 정밀 검색용

임베딩:
- 모델: text-embedding-3-small (OpenAI) 또는 다국어 모델
- 차원: 1536
- VectorDB: Neo4j Vector Index (통합 운영) 또는 Chroma (별도)
```

---

### 11. 실제 구축 로드맵

#### Phase 1: 데이터 준비 (M1-M3)

```
M1: PDF 파싱 파이프라인 완성
────────────────────────────
□ MinerU § 기호 후처리 스크립트 작성
□ SRP Chapter 4, 6, 15 파싱
□ NuScale DCA Chapter 4 파싱
□ 파싱 품질 검증 (사람 검수)

M2: 엔티티 추출
────────────────
□ 규칙 기반 요구사항 추출기 개발
  - "shall/must" 패턴 매칭
  - 섹션번호 정규화
  - GDC 참조 추출
□ LLM 기반 보완 추출
□ 요구사항 목록 DB 구축 (Chapter 4 우선)

M3: 매핑 테이블 구축
────────────────────
□ SRP 4.x 요구사항 ↔ SAR 4.x 섹션 매핑
□ NuScale DCA 4.x 패턴 추출
□ SMART 설계 데이터 스키마 초안 (엔지니어와 협의)
□ 매핑 테이블 검수 (도메인 전문가)
```

#### Phase 2: 지식그래프 구축 (M4-M6)

```
M4: 온톨로지 스키마 확정
────────────────────────
□ DIAMOND 온톨로지 분석 & 확장 범위 결정
□ SAR 온톨로지 스키마 최종 확정
□ Neo4j 인스턴스 구축
□ 스키마 제약조건(Constraint) 설정

M5: 데이터 적재
────────────────
□ ETL 파이프라인 개발 (Python)
  - 파싱 데이터 → 엔티티 변환 → Neo4j 적재
□ Chapter 4 데이터 1차 적재
□ 관계 자동 생성 (FULFILLS, DERIVED_FROM, REFERENCES)
□ VectorDB 병행 적재 (같은 데이터 이중 적재)

M6: 검증 & 보완
────────────────
□ 그래프 쿼리 테스트
  - "SRP 4.2.1 요구사항이 SAR 어디서 충족?" → Cypher 쿼리
  - "열출력 변경 시 영향 범위?" → 그래프 탐색
□ VectorDB 검색 테스트
  - "fuel system design criteria" → 유사 문서 검색
□ 데이터 품질 이슈 수정
□ Chapter 6, 15 확장
```

#### Phase 3: 에이전트 개발 (M7-M10)

```
M7-M8: Tool 개발
─────────────────
□ search_requirements (Neo4j Cypher)
□ search_pattern (VectorDB)
□ get_design_data (Neo4j)
□ get_section_structure (Neo4j)
□ generate_draft (LLM + Template)
□ validate_consistency (Neo4j + LLM)
□ trace_requirement (Neo4j 그래프 탐색)

M9-M10: 에이전트 통합
─────────────────────
□ LLM 에이전트 프레임워크 선택 (LangGraph / CrewAI 등)
□ Tool Calling 워크플로우 구현
□ 에이전트 프롬프트 엔지니어링
□ UI 개발 (Chat + 문서 편집기)
□ 통합 테스트
```

#### Phase 4: 파일럿 & 고도화 (M11-M12)

```
□ Chapter 4 전체 자동 생성 테스트
□ 도메인 전문가 리뷰
□ 피드백 반영 & 성능 최적화
□ 운영 가이드 작성
□ 검증 보고서 작성
```

---

### 12. 핵심 쿼리 예시 (Neo4j Cypher)

```cypher
// 1. 특정 챕터의 모든 요구사항 조회
MATCH (r:Requirement {chapter: 4})
RETURN r.id, r.text, r.category
ORDER BY r.id

// 2. SAR 섹션이 충족하는 요구사항 추적
MATCH (s:SARSection {id: "SAR-4.2.1"})-[:FULFILLS]->(r:Requirement)
RETURN r.id, r.text, r.source

// 3. 설계 데이터 변경 시 영향받는 SAR 섹션 (영향분석)
MATCH (d:DesignData {parameter: "Thermal Power"})-[:IMPACTS]->(s:SARSection)
RETURN s.id, s.title, s.chapter

// 4. 미충족 요구사항 찾기
MATCH (r:Requirement {chapter: 4})
WHERE NOT EXISTS {
    MATCH (s:SARSection)-[:FULFILLS]->(r)
}
RETURN r.id, r.text

// 5. 특정 GDC와 관련된 모든 SAR 섹션
MATCH (reg:Regulation {id: "GDC-10"})<-[:DERIVED_FROM]-(r:Requirement)
      <-[:FULFILLS]-(s:SARSection)
RETURN s.id, s.title, r.id, r.text

// 6. SAR 섹션의 교차참조 네트워크
MATCH (s1:SARSection)-[:REFERENCES]->(s2:SARSection)
WHERE s1.chapter = 4
RETURN s1.id, s2.id, s2.title
```

---

### 13. 기술 스택 정리

| 구분 | 선택 | 이유 |
|------|------|------|
| **지식그래프 DB** | Neo4j 5.x | 원자력 도메인 GraphRAG 지원, DIAMOND 호환 |
| **VectorDB** | Neo4j Vector Index (통합) 또는 Chroma (별도) | Neo4j 자체 벡터 인덱스로 통합 운영 가능 |
| **온톨로지** | DIAMOND 기반 확장 | 원자력 도메인 표준, INL 개발 |
| **PDF 파싱** | MinerU (1차) + 후처리 스크립트 | 구조 보존 최강, § 기호 후처리로 보완 |
| **LLM** | GPT-4급 (또는 망분리 시 국산 LLM) | Tool Calling, 긴 컨텍스트 |
| **RAG 프레임워크** | neo4j-graphrag-python | Neo4j 공식 GraphRAG 라이브러리 |
| **에이전트** | LangGraph 또는 CrewAI | Tool Calling 워크플로우 |
| **임베딩** | text-embedding-3-small | 비용 효율 |
| **백엔드** | Python (FastAPI) | 생태계, 속도 |

---

### 14. 핵심 요약

```
┌─────────────────────────────────────────────────────────────┐
│                    한 줄 요약                                 │
│                                                              │
│  SRP 요구사항 + NuScale 패턴 + SMART 설계 데이터의            │
│  "매핑 관계"를 온톨로지로 정의하고                             │
│  Neo4j 지식그래프 + VectorDB에 적재하면                       │
│  SAR 문서 자동 생성/검증/추적이 가능해진다                     │
└─────────────────────────────────────────────────────────────┘

핵심 공식:

  온톨로지 (개념/관계 정의)
  + 파싱 파이프라인 (PDF → 구조화 데이터)
  + 엔티티/관계 추출 (구조화 데이터 → 노드/엣지)
  + 지식그래프 (Neo4j에 적재)
  + 벡터 인덱싱 (VectorDB에 적재)
  + GraphRAG (하이브리드 검색)
  + 에이전트 (LLM + Tool Calling)
  ──────────────────────────────
  = SAR 자동화 시스템
```

---

### 15. 다음에 할 것 (우선순위)

| 순위 | 작업 | 왜 먼저? |
|:---:|------|---------|
| **1** | MinerU § 기호 후처리 스크립트 작성 | 파싱 품질 확보 |
| **2** | SRP Chapter 4 파싱 & 요구사항 추출 | 파일럿 데이터 |
| **3** | NuScale DCA Chapter 4 파싱 & 패턴 추출 | 작성 패턴 확보 |
| **4** | Neo4j 설치 & 스키마 구현 | 그래프 인프라 |
| **5** | Chapter 4 데이터 적재 & 쿼리 테스트 | PoC 검증 |
| **6** | VectorDB 적재 & RAG 테스트 | 검색 검증 |
| **7** | 첫 번째 Tool (`search_requirements`) 개발 | 에이전트 시작 |

---

## 부록: 용어 사전

| 약어 | 전체 | 한글 |
|------|------|------|
| SAR | Safety Analysis Report | 안전분석보고서 |
| SRP | Standard Review Plan (NUREG-0800) | 표준심사계획서 |
| DSRS | Design-Specific Review Standard | 설계별 심사기준 |
| NRC | Nuclear Regulatory Commission | 미국 원자력규제위원회 |
| RG | Regulatory Guide | 규제지침 |
| DCA | Design Certification Application | 설계인증신청서 |
| SMR | Small Modular Reactor | 소형모듈원자로 |
| LWR | Light Water Reactor | 경수로 |
| GDC | General Design Criteria | 일반설계기준 |
| CFR | Code of Federal Regulations | 연방규정집 |
| RAI | Request for Additional Information | 추가정보요청 (NRC 질의) |
| SMART | System-integrated Modular Advanced ReacTor | 한국형 소형모듈원자로 |
| DIAMOND | Domain Integrated Assessment and Management Of Nuclear Design | INL 원자력 온톨로지 |
| GraphRAG | Graph Retrieval-Augmented Generation | 그래프 기반 검색증강생성 |
| ETL | Extract, Transform, Load | 추출, 변환, 적재 |
| ITAAC | Inspections, Tests, Analyses, and Acceptance Criteria | 검사, 시험, 분석, 수용기준 |
